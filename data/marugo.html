// correction.htmlページにリダイレクト（修正版）
redirectToCorrectionPage(selectedData) {
    try {
        console.log('=== リダイレクト処理開始 ===');
        console.log('選択されたデータ:', selectedData);
        
        // データの検証
        if (!selectedData) {
            throw new Error('送信するデータが無効です');
        }
        
        // sessionStorageに選択されたデータを保存
        const dataToSave = JSON.stringify(selectedData);
        console.log('保存するデータ:', dataToSave);
        
        sessionStorage.setItem('correctionData', dataToSave);
        console.log('sessionStorageへの保存完了');
        
        // 保存されたデータを確認
        const savedData = sessionStorage.getItem('correctionData');
        console.log('保存確認:', savedData ? '成功' : '失敗');
        
        // URLを決定（現在のページの場所に基づいて適切なパスを設定）
        let correctionUrl;
        const currentPath = window.location.pathname;
        console.log('現在のパス:', currentPath);
        
        if (currentPath.includes('/data/')) {
            // data/marugo.html から呼び出された場合
            correctionUrl = '../correction.html';
        } else {
            // ルートディレクトリから呼び出された場合
            correctionUrl = 'correction.html';
        }
        
        console.log('リダイレクト先URL:', correctionUrl);
        
        // correction.htmlページに移動
        window.location.href = correctionUrl;
        
    } catch (error) {
        console.error('リダイレクトエラー:', error);
        alert(`修正ページへの移動中にエラーが発生しました: ${error.message}`);
        
        // デバッグ情報をコンソールに出力
        console.log('エラー時のデバッグ情報:');
        console.log('- 選択されたデータ:', selectedData);
        console.log('- 現在のURL:', window.location.href);
        console.log('- sessionStorage状態:', Object.keys(sessionStorage));
    }
}

// 削除確認ダイアログを表示（修正版）
showDeleteConfirmDialog(selectedData) {
    console.log('確認ダイアログ表示:', selectedData);
    
    const formattedAmount = selectedData.amount ? 
        `¥${parseInt(selectedData.amount).toLocaleString('ja-JP')}` : 
        '不明';
    
    const confirmMessage = `🗑️ 以下のデータを逆取引として修正送信しますか？

📅 日付: ${selectedData.date || '不明'}
👤 入力者: ${selectedData.name || '不明'}
📤 貸主: ${selectedData.lender || '不明'}
📥 借主: ${selectedData.borrower || '不明'}
🏷️ カテゴリー: ${selectedData.category || '不明'}
📝 品目: ${selectedData.item || '不明'}
💵 金額: ${formattedAmount}

⚠️ この操作により：
• 貸主と借主が入れ替わった逆取引データが作成されます
• 自動的に「✏️修正」マークが付与されます
• 修正用ページに移動します

続行しますか？`;

    if (confirm(confirmMessage)) {
        console.log('ユーザーが確認 - リダイレクト開始');
        this.redirectToCorrectionPage(selectedData);
    } else {
        console.log('ユーザーがキャンセル');
    }
}
