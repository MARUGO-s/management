# かき氷レシピアーカイブ - 使い方ガイド

このフォルダは、かき氷のレシピを月別に管理するためのアーカイブシステムです。

## 🌐 GitHub Pagesで公開する場合

**GitHub Pagesにデプロイする場合は、[DEPLOY.md](./DEPLOY.md) をご覧ください。**

静的サイトとして公開するため、ファイルアップロード機能や更新ボタンは使用できません。ローカルで `npm run recipes:static` を実行してからGitHubにプッシュしてください。

## 📁 ファイル構成

```
dome/
├── recipes.html                # レシピ一覧ページ（自動生成）
├── generate-recipes.js         # レシピページ自動生成スクリプト（ローカル開発用）
├── generate-recipes-static.js  # 静的版生成スクリプト（GitHub Pages用）
├── server.js                   # ローカルサーバー（ローカル開発用）
├── 202512.html                 # 2025年12月のレシピ
├── 202601.html                 # 2026年1月のレシピ
├── README.md                   # このファイル
└── DEPLOY.md                   # GitHub Pagesデプロイ手順
```

## ✨ 特徴

### ローカル開発環境
- **ファイルアップロード機能**: ブラウザから直接HTMLファイルをアップロード可能（ローカルのみ）
- **完全自動化**: HTMLファイルを追加して、ボタンをクリックするだけ
- **ワンクリック更新**: ボタンをクリックするだけでレシピページを更新

### GitHub Pages（本番環境）
- **静的サイトホスティング**: GitHub Pagesで無料公開可能
- **自動デプロイ**: Gitでプッシュするだけで自動的に更新
- **サーバー不要**: 完全な静的HTMLとして動作

### 共通機能
- **自動検出**: YYYYMM.html 形式のファイルを自動的に検出
- **タイトル抽出**: 各HTMLファイルから自動的にタイトルと説明を抽出
- **日付順ソート**: 新しいレシピが自動的に上位に表示

## 🚀 新しいレシピの追加方法

> **GitHub Pagesで公開している場合は、[DEPLOY.md](./DEPLOY.md)の「新しいレシピを追加する方法」を参照してください。**

### ローカル開発環境での追加方法

#### 方法1: ブラウザからファイルをアップロード（最も簡単・ローカルのみ）

1. **サーバーを起動**（初回のみ）
   ```bash
   # プロジェクトルートから
   npm run recipes
   ```

   以下のように表示されます：
   ```
   🚀 レシピサーバーが起動しました！
   📖 レシピページ: http://localhost:3456/recipes.html
   ```

2. **ブラウザで開く**

   http://localhost:3456/recipes.html にアクセス

3. **ファイルをアップロード**

   - 「📤 新しいレシピをアップロード」セクションで「ファイルを選択」をクリック
   - `YYYYMM.html` 形式のファイルを選択（例：202602.html）
   - 「📁 アップロード」ボタンをクリック

   → 自動的にアップロード＆ページが更新されます！

#### 方法2: フォルダに追加してボタンをクリック（ローカルのみ）

1. **サーバーを起動**（上記と同じ）

2. **ブラウザで開く**

   http://localhost:3456/recipes.html にアクセス

3. **HTMLファイルを追加**

   domeフォルダに `YYYYMM.html` 形式でファイルを追加
   - 例: `202602.html` → 2026年2月のレシピ

4. **ボタンをクリック**

   recipes.html の「🔄 レシピを更新」ボタンをクリック

   → 自動的にページが更新されます！

#### 方法3: ターミナルで実行（サーバー不要・ローカルのみ）

サーバーを使わない場合は、従来通りコマンドで実行できます：

```bash
# domeフォルダ内から実行する場合
node generate-recipes.js

# プロジェクトルートから実行する場合
node dome/generate-recipes.js
```

その後、ブラウザで `dome/recipes.html` を開いて確認してください。

### GitHub Pagesで公開している場合の追加方法

#### 方法: ローカルで生成してGitHubにプッシュ

1. **新しいレシピファイルを追加**

   domeフォルダに `YYYYMM.html` 形式でファイルを追加

   例: `202602.html` → 2026年2月のレシピ

2. **静的版を生成**

   ```bash
   # プロジェクトルートから
   npm run recipes:static

   # または、domeフォルダから
   node generate-recipes-static.js
   ```

3. **GitHubにプッシュ**

   ```bash
   git add dome/202602.html dome/recipes.html
   git commit -m "Add recipe for February 2026"
   git push origin main
   ```

4. **数分後、GitHub Pagesに自動的に反映されます！**

詳しくは [DEPLOY.md](./DEPLOY.md) をご覧ください。

## 📋 HTMLファイルの命名規則

- **必須形式**: `YYYYMM.html`
- **例**:
  - ✅ `202601.html` （正しい）
  - ✅ `202512.html` （正しい）
  - ❌ `2026-01.html` （ハイフンは不可）
  - ❌ `january-2026.html` （英語名は不可）
  - ❌ `recipe.html` （日付が必要）

## 🎨 HTMLファイルの推奨構造

スクリプトが適切にタイトルと説明を抽出できるよう、以下の構造を推奨します：

```html
<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>レシピのタイトル</title>
</head>
<body>
    <h1>メインタイトル</h1>
    <h2>1. セクション1</h2>
    <h2>2. セクション2</h2>
    <h2>3. セクション3</h2>
    <!-- ... -->
</body>
</html>
```

**抽出されるもの:**
- `<title>` タグ → カードのタイトルとして使用
- 最初の3つの `<h2>` タグ → 説明文として使用

## 🔧 トラブルシューティング

### スクリプトがエラーになる

```bash
# Node.jsがインストールされているか確認
node --version

# v14以上が必要です
```

### レシピが表示されない

1. ファイル名が `YYYYMM.html` 形式か確認
2. スクリプトを実行したか確認
3. ブラウザのキャッシュをクリア

### タイトルが正しく表示されない

HTMLファイルに `<title>` タグまたは `<h1>` タグが含まれているか確認してください。

## 📊 スクリプトの動作

`generate-recipes.js` は以下の処理を実行します：

1. **ファイルスキャン**: domeフォルダ内の全HTMLファイルを検索
2. **フィルタリング**: `YYYYMM.html` 形式のファイルのみを抽出（recipes.htmlは除外）
3. **メタデータ抽出**: 各ファイルから以下を抽出
   - タイトル（`<title>` または `<h1>`）
   - 説明（最初の3つの `<h2>` タグ）
4. **ソート**: 日付順（新しい順）にソート
5. **HTML生成**: recipes.html を自動生成
6. **タイムスタンプ**: 最終更新日時を自動記録

## 💡 Tips

### 複数のレシピを一度に追加

複数のHTMLファイルを追加した後、スクリプトを1回実行するだけで全て反映されます。

```bash
# 3つのレシピを追加
202602.html
202603.html
202604.html

# 1回実行するだけ
node generate-recipes.js
```

### 既存のレシピを編集

既存のHTMLファイル（例: 202601.html）を編集した後、スクリプトを実行すれば、タイトルや説明が自動的に更新されます。

### レシピを削除

1. 該当するHTMLファイルを削除
2. スクリプトを実行
3. recipes.html から自動的に削除されます

## 🔒 セキュリティと注意事項

### ファイルアップロード機能

- **ローカル環境のみ**: このサーバーはローカル環境（localhost）でのみ使用してください
- **ファイル形式**: HTMLファイルのみアップロード可能
- **ファイル名検証**: YYYYMM.html 形式のみ許可（例：202602.html）
- **自動検証**: サーバー側でファイル名とファイル形式を自動的に検証

### 推奨事項

- インターネットに公開しないでください（ローカル開発用）
- アップロードするHTMLファイルは信頼できるソースからのみ
- 定期的にバックアップを取得してください

## 🎯 今後の拡張

このシステムは以下のように拡張できます：

- タグやカテゴリーの追加
- 検索機能の実装
- 原価情報の自動集計
- JSON形式でのデータエクスポート
- 複数ファイルの一括アップロード
- ドラッグ＆ドロップでのアップロード

## 📞 サポート

問題が発生した場合は、以下を確認してください：

1. Node.js v14以上がインストールされているか
2. ファイル名が正しい形式か
3. HTMLファイルに必要なタグ（title, h1, h2）が含まれているか

---

**最終更新**: 2025年12月31日
